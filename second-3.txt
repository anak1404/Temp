Adding bug fixes from second commit 
